---
import BaseLayout from '../../layouts/BaseLayout.astro';
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import Card from '../../components/ui/Card.astro';
import Button from '../../components/ui/Button.astro';
---

<BaseLayout title="Tương thích sản phẩm - ComputerPOS Pro">
  <DashboardLayout>
    <main class="p-6 space-y-6">
      <!-- Header -->
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Tương thích sản phẩm</h1>
          <p class="text-gray-600 mt-1">Kiểm tra tính tương thích giữa các linh kiện</p>
        </div>
        <div class="flex space-x-3">
          <Button href="/products" variant="secondary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m0 7h18" />
            </svg>
            Quay lại
          </Button>
          <Button variant="primary" id="check-compatibility">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Kiểm tra tương thích
          </Button>
        </div>
      </div>

      <!-- Compatibility Checker -->
      <Card>
        <div class="p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Kiểm tra tương thích linh kiện</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- CPU Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">CPU</label>
              <select id="cpu-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Chọn CPU</option>
                <option value="i7-13700k" data-socket="LGA1700" data-ram="DDR5">Intel Core i7-13700K</option>
                <option value="i5-13400f" data-socket="LGA1700" data-ram="DDR4/DDR5">Intel Core i5-13400F</option>
                <option value="r7-7700x" data-socket="AM5" data-ram="DDR5">AMD Ryzen 7 7700X</option>
                <option value="r5-7600x" data-socket="AM5" data-ram="DDR5">AMD Ryzen 5 7600X</option>
              </select>
            </div>

            <!-- Motherboard Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Mainboard</label>
              <select id="motherboard-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Chọn Mainboard</option>
                <option value="z790-pro" data-socket="LGA1700" data-ram="DDR5">ASUS ROG Strix Z790-E</option>
                <option value="b760-gaming" data-socket="LGA1700" data-ram="DDR4">MSI MAG B760 Gaming</option>
                <option value="x670-elite" data-socket="AM5" data-ram="DDR5">Gigabyte X670 AORUS Elite</option>
                <option value="b650-pro" data-socket="AM5" data-ram="DDR5">ASUS TUF Gaming B650-Pro</option>
              </select>
            </div>

            <!-- RAM Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">RAM</label>
              <select id="ram-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Chọn RAM</option>
                <option value="corsair-ddr5" data-type="DDR5">Corsair Vengeance 32GB DDR5</option>
                <option value="gskill-ddr5" data-type="DDR5">G.Skill Trident Z5 32GB DDR5</option>
                <option value="corsair-ddr4" data-type="DDR4">Corsair Vengeance LPX 32GB DDR4</option>
                <option value="gskill-ddr4" data-type="DDR4">G.Skill Ripjaws V 32GB DDR4</option>
              </select>
            </div>

            <!-- VGA Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">VGA</label>
              <select id="vga-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Chọn VGA</option>
                <option value="rtx-4080" data-power="320W">NVIDIA RTX 4080</option>
                <option value="rtx-4070" data-power="200W">NVIDIA RTX 4070</option>
                <option value="rx-7800xt" data-power="263W">AMD RX 7800 XT</option>
                <option value="rx-7700xt" data-power="245W">AMD RX 7700 XT</option>
              </select>
            </div>

            <!-- PSU Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Nguồn</label>
              <select id="psu-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Chọn Nguồn</option>
                <option value="rm850x" data-wattage="850">Corsair RM850x 850W</option>
                <option value="rm750x" data-wattage="750">Corsair RM750x 750W</option>
                <option value="focus-850" data-wattage="850">Seasonic Focus GX-850</option>
                <option value="focus-650" data-wattage="650">Seasonic Focus GX-650</option>
              </select>
            </div>

            <!-- Case Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Case</label>
              <select id="case-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Chọn Case</option>
                <option value="o11-dynamic" data-clearance="165mm">Lian Li O11 Dynamic</option>
                <option value="h510" data-clearance="165mm">NZXT H510</option>
                <option value="define-7" data-clearance="185mm">Fractal Design Define 7</option>
                <option value="meshify-c" data-clearance="170mm">Fractal Design Meshify C</option>
              </select>
            </div>
          </div>
        </div>
      </Card>

      <!-- Compatibility Results -->
      <Card id="compatibility-results" class="hidden">
        <div class="p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Kết quả kiểm tra tương thích</h3>
          <div id="results-content" class="space-y-4">
            <!-- Results will be populated here -->
          </div>
        </div>
      </Card>

      <!-- Compatibility Matrix -->
      <Card>
        <div class="p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Ma trận tương thích</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Socket</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">CPU</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mainboard</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">RAM</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ghi chú</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">LGA1700</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Intel 12th, 13th Gen</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Z790, B760, H770</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">DDR4/DDR5</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Tùy mainboard</td>
                </tr>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">AM5</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">AMD Ryzen 7000</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">X670, B650, A620</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">DDR5</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Chỉ hỗ trợ DDR5</td>
                </tr>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">AM4</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">AMD Ryzen 1000-5000</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">X570, B550, A520</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">DDR4</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Thế hệ cũ</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </Card>
    </main>
  </DashboardLayout>
</BaseLayout>

<script>
  // Compatibility checker functionality
  document.addEventListener('DOMContentLoaded', function() {
    const cpuSelect = document.getElementById('cpu-select');
    const motherboardSelect = document.getElementById('motherboard-select');
    const ramSelect = document.getElementById('ram-select');
    const vgaSelect = document.getElementById('vga-select');
    const psuSelect = document.getElementById('psu-select');
    const caseSelect = document.getElementById('case-select');
    const resultsCard = document.getElementById('compatibility-results');
    const resultsContent = document.getElementById('results-content');

    // Auto-check compatibility when selections change
    [cpuSelect, motherboardSelect, ramSelect, vgaSelect, psuSelect, caseSelect].forEach(select => {
      select.addEventListener('change', checkCompatibility);
    });

    // Manual check button
    document.getElementById('check-compatibility')?.addEventListener('click', checkCompatibility);

    function checkCompatibility() {
      const cpu = cpuSelect.selectedOptions[0];
      const motherboard = motherboardSelect.selectedOptions[0];
      const ram = ramSelect.selectedOptions[0];
      const vga = vgaSelect.selectedOptions[0];
      const psu = psuSelect.selectedOptions[0];

      if (!cpu || !motherboard || !ram) {
        resultsCard.classList.add('hidden');
        return;
      }

      const issues = [];
      const warnings = [];
      const compatible = [];

      // Check CPU-Motherboard compatibility
      const cpuSocket = cpu.dataset.socket;
      const mbSocket = motherboard.dataset.socket;

      if (cpuSocket === mbSocket) {
        compatible.push('✅ CPU và Mainboard tương thích (Socket ' + cpuSocket + ')');
      } else {
        issues.push('❌ CPU và Mainboard không tương thích (Socket ' + cpuSocket + ' vs ' + mbSocket + ')');
      }

      // Check RAM compatibility
      const cpuRam = cpu.dataset.ram;
      const mbRam = motherboard.dataset.ram;
      const ramType = ram.dataset.type;

      if (cpuRam.includes(ramType) && mbRam.includes(ramType)) {
        compatible.push('✅ RAM tương thích (' + ramType + ')');
      } else {
        issues.push('❌ RAM không tương thích. CPU hỗ trợ: ' + cpuRam + ', Mainboard hỗ trợ: ' + mbRam + ', RAM: ' + ramType);
      }

      // Check PSU power
      if (vga && psu) {
        const vgaPower = parseInt(vga.dataset.power);
        const psuWattage = parseInt(psu.dataset.wattage);
        const estimatedTotal = vgaPower + 200; // CPU + other components

        if (psuWattage >= estimatedTotal + 100) {
          compatible.push('✅ Nguồn đủ công suất (' + psuWattage + 'W >= ' + estimatedTotal + 'W)');
        } else if (psuWattage >= estimatedTotal) {
          warnings.push('⚠️ Nguồn vừa đủ công suất (' + psuWattage + 'W vs ' + estimatedTotal + 'W). Nên chọn nguồn cao hơn.');
        } else {
          issues.push('❌ Nguồn không đủ công suất (' + psuWattage + 'W < ' + estimatedTotal + 'W)');
        }
      }

      // Display results
      let resultsHTML = '';

      if (compatible.length > 0) {
        resultsHTML += '<div class="bg-green-50 border border-green-200 rounded-lg p-4"><h4 class="font-medium text-green-800 mb-2">Tương thích</h4><ul class="space-y-1">';
        compatible.forEach(item => {
          resultsHTML += '<li class="text-green-700 text-sm">' + item + '</li>';
        });
        resultsHTML += '</ul></div>';
      }

      if (warnings.length > 0) {
        resultsHTML += '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><h4 class="font-medium text-yellow-800 mb-2">Cảnh báo</h4><ul class="space-y-1">';
        warnings.forEach(item => {
          resultsHTML += '<li class="text-yellow-700 text-sm">' + item + '</li>';
        });
        resultsHTML += '</ul></div>';
      }

      if (issues.length > 0) {
        resultsHTML += '<div class="bg-red-50 border border-red-200 rounded-lg p-4"><h4 class="font-medium text-red-800 mb-2">Không tương thích</h4><ul class="space-y-1">';
        issues.forEach(item => {
          resultsHTML += '<li class="text-red-700 text-sm">' + item + '</li>';
        });
        resultsHTML += '</ul></div>';
      }

      resultsContent.innerHTML = resultsHTML;
      resultsCard.classList.remove('hidden');
    }
  });
</script>